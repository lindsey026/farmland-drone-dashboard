"use strict";(self["webpackChunkfarmland_drone_dashboard"]=self["webpackChunkfarmland_drone_dashboard"]||[]).push([[285],{5285:function(t,e,a){a.r(e),a.d(e,{default:function(){return at}});var s=a(6768),i=a(4232);const o={class:"dashboard-map-container"},n={class:"toolbar"},r={class:"toolbar-section"},l={class:"toolbar-section"},c={class:"toolbar-section"},h={class:"map-main-section"},u={class:"map-container"},d={key:0,class:"map-hint"},p={class:"hint-content"},m={key:1,class:"map-hint"},f={class:"hint-content"},g={class:"info-panel"},y={class:"panel-section"},L={class:"info-grid"},M={class:"info-item"},v={class:"info-value"},w={class:"info-item"},k={class:"info-value"},P={class:"info-item"},A={class:"info-value"},b={class:"info-item"},_={class:"info-value"},T={class:"panel-section"},D={class:"environment-cards"},C={class:"environment-card"},S={class:"card-content"},E={class:"card-value"},I={class:"environment-card"},R={class:"card-content"},z={class:"card-value"},W={class:"environment-card"},O={class:"card-content"},B={class:"card-value"},x={class:"environment-card"},H={class:"card-content"},j={class:"card-value"},N={class:"panel-section"},$={class:"quick-actions"},G={key:0,class:"result-modal"},V={class:"modal-content"},F={class:"modal-title"},q={class:"modal-body"},U={class:"modal-footer"};function J(t,e,a,J,Q,X){return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",n,[(0,s.Lk)("div",r,[(0,s.Lk)("button",{class:(0,i.C4)(["toolbar-btn",{active:Q.showCropHealth}]),onClick:e[0]||(e[0]=(...t)=>X.toggleCropHealth&&X.toggleCropHealth(...t))},[...e[16]||(e[16]=[(0,s.Lk)("span",{class:"btn-icon"},"ğŸŒ±",-1),(0,s.eW)(" ä½œç‰©å¥åº· ",-1)])],2),(0,s.Lk)("button",{class:(0,i.C4)(["toolbar-btn",{active:Q.showDronePaths}]),onClick:e[1]||(e[1]=(...t)=>X.toggleDronePaths&&X.toggleDronePaths(...t))},[...e[17]||(e[17]=[(0,s.Lk)("span",{class:"btn-icon"},"âœˆï¸",-1),(0,s.eW)(" é£è¡Œè·¯çº¿ ",-1)])],2),(0,s.Lk)("button",{class:(0,i.C4)(["toolbar-btn",{active:Q.showPestAreas}]),onClick:e[2]||(e[2]=(...t)=>X.togglePestAreas&&X.togglePestAreas(...t))},[...e[18]||(e[18]=[(0,s.Lk)("span",{class:"btn-icon"},"ğŸ›",-1),(0,s.eW)(" ç—…è™«å®³åŒºåŸŸ ",-1)])],2)]),e[24]||(e[24]=(0,s.eW)("> ",-1)),(0,s.Lk)("div",l,[(0,s.Lk)("button",{class:(0,i.C4)(["toolbar-btn",{active:Q.isSelectingArea}]),onClick:e[3]||(e[3]=(...t)=>X.toggleAreaSelection&&X.toggleAreaSelection(...t))},[...e[19]||(e[19]=[(0,s.Lk)("span",{class:"btn-icon"},"ğŸ—ºï¸",-1),(0,s.eW)(" æ¡†é€‰èŒƒå›´ ",-1)])],2),(0,s.Lk)("button",{class:(0,i.C4)(["toolbar-btn",{active:Q.isEditingPath}]),onClick:e[4]||(e[4]=(...t)=>X.togglePathEdit&&X.togglePathEdit(...t))},[...e[20]||(e[20]=[(0,s.Lk)("span",{class:"btn-icon"},"âœï¸",-1),(0,s.eW)(" è°ƒæ•´è·¯å¾„ ",-1)])],2),(0,s.Lk)("button",{class:"toolbar-btn",onClick:e[5]||(e[5]=(...t)=>X.toggleManualPathPlanning&&X.toggleManualPathPlanning(...t))},[...e[21]||(e[21]=[(0,s.Lk)("span",{class:"btn-icon"},"ğŸ§­",-1),(0,s.eW)(" æ‰‹åŠ¨è§„åˆ’ ",-1)])])]),(0,s.Lk)("div",c,[(0,s.Lk)("button",{class:"toolbar-btn primary",onClick:e[6]||(e[6]=(...t)=>X.generateOptimalPath&&X.generateOptimalPath(...t))},[...e[22]||(e[22]=[(0,s.Lk)("span",{class:"btn-icon"},"ğŸš€",-1),(0,s.eW)(" æ™ºèƒ½ä¼˜åŒ–è·¯å¾„ ",-1)])]),(0,s.Lk)("button",{class:"toolbar-btn success",onClick:e[7]||(e[7]=(...t)=>X.executeTask&&X.executeTask(...t))},[...e[23]||(e[23]=[(0,s.Lk)("span",{class:"btn-icon"},"â–¶ï¸",-1),(0,s.eW)(" æ‰§è¡Œä»»åŠ¡ ",-1)])])])]),(0,s.Lk)("div",h,[(0,s.Lk)("div",u,[e[27]||(e[27]=(0,s.Lk)("div",{id:"map",class:"map"},null,-1)),e[28]||(e[28]=(0,s.Lk)("div",{class:"map-brand"},"é«˜å¾·åœ°å›¾ 2025 Â· ç©ºé—´æ™ºèƒ½",-1)),Q.isSelectingArea?((0,s.uX)(),(0,s.CE)("div",d,[(0,s.Lk)("div",p,[e[25]||(e[25]=(0,s.Lk)("span",{class:"hint-text"},"è¯·åœ¨åœ°å›¾ä¸Šç‚¹å‡»ç»˜åˆ¶å¤šè¾¹å½¢åŒºåŸŸï¼ŒåŒå‡»å®Œæˆç»˜åˆ¶",-1)),(0,s.Lk)("button",{class:"hint-close",onClick:e[8]||(e[8]=(...t)=>X.cancelAreaSelection&&X.cancelAreaSelection(...t))},"å–æ¶ˆ")])])):(0,s.Q3)("",!0),Q.isEditingPath?((0,s.uX)(),(0,s.CE)("div",m,[(0,s.Lk)("div",f,[e[26]||(e[26]=(0,s.Lk)("span",{class:"hint-text"},"æ‹–åŠ¨è·¯å¾„ç‚¹è°ƒæ•´é£è¡Œè·¯çº¿ï¼Œç‚¹å‡»è·¯å¾„æ·»åŠ æ–°ç‚¹",-1)),(0,s.Lk)("button",{class:"hint-close",onClick:e[9]||(e[9]=(...t)=>X.cancelPathEdit&&X.cancelPathEdit(...t))},"å®Œæˆç¼–è¾‘")])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",g,[(0,s.Lk)("div",y,[e[33]||(e[33]=(0,s.Lk)("h3",{class:"panel-title"},"åŒºåŸŸä¿¡æ¯",-1)),(0,s.Lk)("div",L,[(0,s.Lk)("div",M,[e[29]||(e[29]=(0,s.Lk)("span",{class:"info-label"},"é¢ç§¯:",-1)),(0,s.Lk)("span",v,(0,i.v_)(Q.selectedArea?.area||"0")+" äº©",1)]),(0,s.Lk)("div",w,[e[30]||(e[30]=(0,s.Lk)("span",{class:"info-label"},"å‘¨é•¿:",-1)),(0,s.Lk)("span",k,(0,i.v_)(Q.selectedArea?.perimeter||"0")+" ç±³",1)]),(0,s.Lk)("div",P,[e[31]||(e[31]=(0,s.Lk)("span",{class:"info-label"},"å¹³å‡é«˜åº¦:",-1)),(0,s.Lk)("span",A,(0,i.v_)(Q.selectedArea?.avgHeight||"0")+" ç±³",1)]),(0,s.Lk)("div",b,[e[32]||(e[32]=(0,s.Lk)("span",{class:"info-label"},"ä½œç‰©ç±»å‹:",-1)),(0,s.Lk)("span",_,(0,i.v_)(Q.selectedArea?.cropType||"æœªé€‰æ‹©"),1)])])]),(0,s.Lk)("div",T,[e[43]||(e[43]=(0,s.Lk)("h3",{class:"panel-title"},"ç¯å¢ƒæ•°æ®",-1)),(0,s.Lk)("div",D,[(0,s.Lk)("div",C,[e[35]||(e[35]=(0,s.Lk)("span",{class:"card-icon temperature-icon"},null,-1)),(0,s.Lk)("div",S,[(0,s.Lk)("span",E,(0,i.v_)(Q.environmentData.temperature)+"Â°C",1),e[34]||(e[34]=(0,s.Lk)("span",{class:"card-label"},"æ¸©åº¦",-1))])]),(0,s.Lk)("div",I,[e[37]||(e[37]=(0,s.Lk)("span",{class:"card-icon humidity-icon"},null,-1)),(0,s.Lk)("div",R,[(0,s.Lk)("span",z,(0,i.v_)(Q.environmentData.humidity)+"%",1),e[36]||(e[36]=(0,s.Lk)("span",{class:"card-label"},"æ¹¿åº¦",-1))])]),(0,s.Lk)("div",W,[e[39]||(e[39]=(0,s.Lk)("span",{class:"card-icon wind-icon"},null,-1)),(0,s.Lk)("div",O,[(0,s.Lk)("span",B,(0,i.v_)(Q.environmentData.windSpeed)+" m/s",1),e[38]||(e[38]=(0,s.Lk)("span",{class:"card-label"},"é£é€Ÿ",-1))])]),(0,s.Lk)("div",x,[e[41]||(e[41]=(0,s.Lk)("span",{class:"card-icon precipitation-icon"},null,-1)),(0,s.Lk)("div",H,[(0,s.Lk)("span",j,(0,i.v_)(Q.environmentData.precipitation)+" mm",1),e[40]||(e[40]=(0,s.Lk)("span",{class:"card-label"},"é™æ°´é‡",-1))])])]),(0,s.Lk)("button",{class:"refresh-btn",onClick:e[10]||(e[10]=(...t)=>X.fetchEnvironmentData&&X.fetchEnvironmentData(...t))},[...e[42]||(e[42]=[(0,s.Lk)("i",{class:"refresh-icon"},"ğŸ”„",-1),(0,s.eW)(" åˆ·æ–°æ•°æ® ",-1)])])]),(0,s.Lk)("div",N,[e[48]||(e[48]=(0,s.Lk)("h3",{class:"panel-title"},"å¿«é€Ÿåˆ†æ",-1)),(0,s.Lk)("div",$,[(0,s.Lk)("button",{class:"quick-action-btn",onClick:e[11]||(e[11]=(...t)=>X.analyzeCropHealth&&X.analyzeCropHealth(...t))},[...e[44]||(e[44]=[(0,s.Lk)("i",{class:"action-icon"},"ğŸŒ±",-1),(0,s.eW)(" ä½œç‰©å¥åº·åˆ†æ ",-1)])]),(0,s.Lk)("button",{class:"quick-action-btn",onClick:e[12]||(e[12]=(...t)=>X.analyzeSoilCondition&&X.analyzeSoilCondition(...t))},[...e[45]||(e[45]=[(0,s.Lk)("i",{class:"action-icon"},"ğŸ§ª",-1),(0,s.eW)(" åœŸå£¤æ¡ä»¶åˆ†æ ",-1)])]),(0,s.Lk)("button",{class:"quick-action-btn",onClick:e[13]||(e[13]=(...t)=>X.predictHarvest&&X.predictHarvest(...t))},[...e[46]||(e[46]=[(0,s.Lk)("i",{class:"action-icon"},"ğŸ“Š",-1),(0,s.eW)(" äº§é‡é¢„æµ‹ ",-1)])]),(0,s.Lk)("button",{class:"quick-action-btn",onClick:e[14]||(e[14]=(...t)=>X.optimizeIrrigation&&X.optimizeIrrigation(...t))},[...e[47]||(e[47]=[(0,s.Lk)("i",{class:"action-icon"},"ğŸ’§",-1),(0,s.eW)(" çŒæº‰ä¼˜åŒ– ",-1)])])])])])]),Q.showResultModal?((0,s.uX)(),(0,s.CE)("div",G,[(0,s.Lk)("div",V,[(0,s.Lk)("h3",F,(0,i.v_)(Q.resultModalTitle),1),(0,s.Lk)("div",q,(0,i.v_)(Q.resultModalMessage),1),(0,s.Lk)("div",U,[(0,s.Lk)("button",{class:"modal-btn",onClick:e[15]||(e[15]=(...t)=>X.closeResultModal&&X.closeResultModal(...t))},"ç¡®å®š")])])])):(0,s.Q3)("",!0)])}a(4114),a(8111),a(7588),a(1701);var Q=a(6886),X=a.n(Q);class Z{constructor(){this.optimalPath=[],this.map=null,this.pathLayer=null}initialize(t){try{if(!t||"object"!==typeof t)return void console.error("åœ°å›¾å®ä¾‹æ— æ•ˆæˆ–ä¸å­˜åœ¨");const s=window.L||X();if("undefined"===typeof s||"function"!==typeof s.layerGroup)return void console.error("Leafletåº“æœªæ­£ç¡®åŠ è½½");if(this.map=t,this.currentPathLayer){try{"function"===typeof this.currentPathLayer.remove?this.currentPathLayer.remove():"function"===typeof t.removeLayer&&t.removeLayer(this.currentPathLayer)}catch(e){console.warn("ç§»é™¤æ—§è·¯å¾„å›¾å±‚å¤±è´¥:",e)}this.currentPathLayer=null}try{this.currentPathLayer=s.layerGroup(),"function"===typeof t.addLayer&&t.addLayer(this.currentPathLayer)}catch(a){console.error("åˆ›å»ºè·¯å¾„å›¾å±‚å¤±è´¥:",a)}console.log("AIè·¯å¾„è§„åˆ’æœåŠ¡åˆå§‹åŒ–å®Œæˆ")}catch(s){console.error("åˆå§‹åŒ–è·¯å¾„è§„åˆ’æœåŠ¡æ—¶å‡ºé”™:",s)}}init(t){this.initialize(t)}generateOptimalRoute(t,e,a,s,i={}){return new Promise((o,n)=>{try{setTimeout(()=>{const n=this._generateBasePathFromVertices(e),r=this._adjustPathForCropType(n,a),l=this._optimizePathByWind(r,s),c=this._avoidObstacles(l,t.obstacles||[]);this.optimalPath=this._optimizePathEfficiency(c,i),this._visualizePath(this.optimalPath);const h=this._calculatePathMetrics(this.optimalPath);o({path:this.optimalPath,metrics:h,success:!0})},2e3)}catch(r){console.error("è·¯å¾„è§„åˆ’å¤±è´¥:",r),n(r)}})}_generateBasePathFromVertices(t){const e=[];let a=1/0,s=-1/0,i=1/0,o=-1/0;t.forEach(t=>{a=Math.min(a,t[0]),s=Math.max(s,t[0]),i=Math.min(i,t[1]),o=Math.max(o,t[1])});const n=s-a,r=o-i;if(n>r)for(let l=0;l<=10;l++){const t=i+r*l/10;e.push([a,t]),e.push([s,t])}else for(let l=0;l<=10;l++){const t=a+n*l/10;e.push([t,i]),e.push([t,o])}return e}_adjustPathForCropType(t,e){const a={"å°éº¦":{spacing:1.2,overlap:.1},"æ°´ç¨»":{spacing:1.5,overlap:.15},"ç‰ç±³":{spacing:2,overlap:.2},"æœæ ‘":{spacing:3,overlap:.25}},s=a[e]||{spacing:1,overlap:.1};return console.log(`æ ¹æ®ä½œç‰©ç±»å‹ ${e} è°ƒæ•´è·¯å¾„ï¼Œé—´è·å› å­: ${s.spacing}, é‡å åº¦: ${s.overlap}`),t}_optimizePathByWind(t,e){if(!e||!e.windSpeed||!e.windDirection)return t;console.log(`æ ¹æ®é£å‘è°ƒæ•´è·¯å¾„ï¼Œé£é€Ÿ: ${e.windSpeed} m/s, é£å‘: ${e.windDirection}`);const a=e.windSpeed,s=e.windDirection;if(a<2)return t;const i=[];for(let o=0;o<t.length-1;o++){const e=t[o],n=t[o+1];i.push(e);const r=this._getWindDirectionAngle(s),l=this._calculateBearing(e[0],e[1],n[0],n[1]),c=Math.abs(this._normalizeAngle(l-r));if(c>60&&c<120){const t=(e[0]+n[0])/2,s=(e[1]+n[1])/2,o=1e-4*(a-2),l=t+o*Math.sin(r*Math.PI/180),c=s+o*Math.cos(r*Math.PI/180);i.push([l,c])}}return i.push(t[t.length-1]),i}_getWindDirectionAngle(t){const e={N:0,NNE:22.5,NE:45,ENE:67.5,E:90,ESE:112.5,SE:135,SSE:157.5,S:180,SSW:202.5,SW:225,WSW:247.5,W:270,WNW:292.5,NW:315,NNW:337.5};return e[t]||0}_calculateBearing(t,e,a,s){const i=t*Math.PI/180,o=a*Math.PI/180,n=(s-e)*Math.PI/180,r=Math.sin(n)*Math.cos(o),l=Math.cos(i)*Math.sin(o)-Math.sin(i)*Math.cos(o)*Math.cos(n),c=Math.atan2(r,l);return(180*c/Math.PI+360)%360}_normalizeAngle(t){return(t%360+360)%360}_avoidObstacles(t,e){if(!e||0===e.length)return t;console.log(`é¿å¼€ ${e.length} ä¸ªéšœç¢ç‰©`);const a=[];for(let s=0;s<t.length-1;s++){const i=t[s],o=t[s+1];let n=!1,r=null;for(const t of e)if(this._checkPathObstacleCollision(i,o,t)){n=!0,r=t;break}if(a.push(i),n){const t=this._generateDetour(i,o,r);a.push(...t)}}return a.push(t[t.length-1]),a}_checkPathObstacleCollision(t,e,a){if(!a.center||!a.radius)return!1;const s=a.center,i=a.radius,o=i/111e3,n=this._calculateDistanceToSegment(t[0],t[1],e[0],e[1],s[0],s[1]);return n<o}_calculateDistanceToSegment(t,e,a,s,i,o){const n=i-t,r=o-e,l=a-t,c=s-e,h=n*l+r*c,u=l*l+c*c;let d,p,m=-1;0!==u&&(m=h/u),m<0?(d=t,p=e):m>1?(d=a,p=s):(d=t+m*l,p=e+m*c);const f=i-d,g=o-p;return Math.sqrt(f*f+g*g)}_generateDetour(t,e,a){const s=[],i=a.center,o=a.radius/111e3,n=[t[0]-i[0],t[1]-i[1]],r=[e[0]-i[0],e[1]-i[1]],l=t=>{const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]},c=l(n),h=l(r),u=[-c[1],c[0]],d=[-h[1],h[0]],p=[i[0]+c[0]*(1.2*o)+u[0]*(1.2*o),i[1]+c[1]*(1.2*o)+u[1]*(1.2*o)],m=[i[0]+h[0]*(1.2*o)+d[0]*(1.2*o),i[1]+h[1]*(1.2*o)+d[1]*(1.2*o)];return s.push(p),s.push(m),s}_optimizePathEfficiency(t,e){console.log("ä¼˜åŒ–è·¯å¾„æ•ˆç‡ï¼Œå‡å°‘è½¬æŠ˜å’Œæ€»è·ç¦»");const a=this._simplifyPath(t,1e-5),s=this._smoothPath(a,e);return s}_simplifyPath(t,e){if(t.length<=2)return t;const a=[t[0]];for(let s=1;s<t.length-1;s++){const i=t[s-1],o=t[s],n=t[s+1],r=this._calculateDistanceToSegment(i[0],i[1],n[0],n[1],o[0],o[1]);r>e&&a.push(o)}return a.push(t[t.length-1]),a}_smoothPath(t,e){if(t.length<=2)return t;const a=e.maxTurnAngle||30,s=[];s.push(t[0]);for(let i=1;i<t.length-1;i++){const e=t[i-1],o=t[i],n=t[i+1],r=this._calculateBearing(e[0],e[1],o[0],o[1]),l=this._calculateBearing(o[0],o[1],n[0],n[1]),c=Math.abs(this._normalizeAngle(r-l));if(c>a){const t=[(e[0]+o[0])/2,(e[1]+o[1])/2],a=[(o[0]+n[0])/2,(o[1]+n[1])/2];s.push(t),s.push(o),s.push(a)}else s.push(o)}return s.push(t[t.length-1]),s}_calculatePathMetrics(t){if(!t||t.length<2)return{totalDistance:0,estimatedTime:0};let e=0;for(let s=1;s<t.length;s++){const a=t[s-1],i=t[s];e+=this._calculateDistance(a[0],a[1],i[0],i[1])}const a=e/5;return{totalDistance:Math.round(e),estimatedTime:Math.round(a),waypoints:t.length,estimatedEfficiency:this._calculateEfficiency(t)}}_calculateDistance(t,e,a,s){const i=6371e3,o=t*Math.PI/180,n=a*Math.PI/180,r=(a-t)*Math.PI/180,l=(s-e)*Math.PI/180,c=Math.sin(r/2)*Math.sin(r/2)+Math.cos(o)*Math.cos(n)*Math.sin(l/2)*Math.sin(l/2),h=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return i*h}_calculateEfficiency(t){if(!t||t.length<2)return 0;let e=0;for(let r=1;r<t.length;r++)e+=this._calculateDistance(t[r-1][0],t[r-1][1],t[r][0],t[r][1]);let a=0,s=0;for(let r=1;r<t.length-1;r++){const e=this._calculateBearing(t[r-1][0],t[r-1][1],t[r][0],t[r][1]),i=this._calculateBearing(t[r][0],t[r][1],t[r+1][0],t[r+1][1]),o=Math.abs(this._normalizeAngle(e-i));o>5&&(a+=o,s++)}const i=s>0?a/s:0;let o=100;const n=this._calculateEstimatedOptimalDistance();if(n>0&&e>n){const t=Math.min(e/n,2);o*=.5*(2-t)+.5}if(i>0){const t=Math.min(i/180,.3);o*=1-t}return Math.max(0,Math.min(100,o))}_calculateEstimatedOptimalDistance(){return 1e3}_visualizePath(t){try{if(!t||!Array.isArray(t)||t.length<2)return void console.warn("è·¯å¾„å¯è§†åŒ–å¤±è´¥ï¼šæ— æ•ˆçš„è·¯å¾„æ•°æ®");const i=window.L||X();if(!i||"object"!==typeof i||"function"!==typeof i.polyline)return void console.warn("è·¯å¾„å¯è§†åŒ–å¤±è´¥ï¼šLeafletåº“æœªæ­£ç¡®åŠ è½½");if(!this.map||"object"!==typeof this.map)return void console.warn("è·¯å¾„å¯è§†åŒ–å¤±è´¥ï¼šåœ°å›¾å®ä¾‹ä¸å­˜åœ¨æˆ–æ— æ•ˆ");if(this.currentPathLayer){try{"function"===typeof this.currentPathLayer.remove?this.currentPathLayer.remove():this.map&&"function"===typeof this.map.removeLayer&&this.map.removeLayer(this.currentPathLayer)}catch(e){console.warn("ç§»é™¤æ—§è·¯å¾„å›¾å±‚å¤±è´¥:",e)}this.currentPathLayer=null}if(i&&"function"===typeof i.layerGroup)try{this.currentPathLayer=i.layerGroup(),"function"===typeof this.map.addLayer&&this.map.addLayer(this.currentPathLayer)}catch(a){return void console.error("åˆ›å»ºè·¯å¾„å›¾å±‚å¤±è´¥:",a)}try{const e=i.polyline(t,{color:"#ff5722",weight:4,opacity:.8,dashArray:"10, 5"});this.currentPathLayer&&"function"===typeof this.currentPathLayer.addLayer?this.currentPathLayer.addLayer(e):"function"===typeof this.map.addLayer&&this.map.addLayer(e)}catch(s){console.error("åˆ›å»ºè·¯å¾„çº¿æ¡å¤±è´¥:",s)}console.log("è·¯å¾„å¯è§†åŒ–å®Œæˆ")}catch(i){console.error("è·¯å¾„å¯è§†åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:",i)}}get3DPreviewData(){return{path:this.optimalPath,metadata:{version:"1.0",generatedAt:(new Date).toISOString()}}}clearPath(){if(this.currentPathLayer)try{"function"===typeof this.currentPathLayer.clearLayers?this.currentPathLayer.clearLayers():this.map&&"function"===typeof this.map.removeLayer&&this.map.removeLayer(this.currentPathLayer),this.currentPathLayer=null}catch(t){console.warn("æ¸…é™¤è·¯å¾„å›¾å±‚å¤±è´¥:",t)}this.optimalPath=[]}exportPath(t="json"){return"json"===t?JSON.stringify({path:this.optimalPath,metrics:this._calculatePathMetrics(this.optimalPath)},null,2):null}}var K=new Z,Y={name:"DroneDashboardMap",data(){return{map:null,pathService:K,showCropHealth:!1,showDronePaths:!1,showPestAreas:!1,isSelectingArea:!1,isEditingPath:!1,isDrawingPath:!1,drawnItems:null,currentPath:[],currentPathLayer:null,selectedArea:null,selectedVertices:[],environmentData:{temperature:26,humidity:65,windSpeed:3.2,precipitation:0,windDirection:"NE"},cropType:"å°éº¦",droneData:{maxTurnAngle:30,operationWidth:5},showResultModal:!1,resultModalTitle:"",resultModalMessage:""}},mounted(){this.initializeMap(),this.fetchEnvironmentData()},methods:{initializeMap(){try{if(!window.L||"object"!==typeof window.L)return void console.error("Leafletåº“æœªæ­£ç¡®åŠ è½½");if("function"!==typeof window.L.map||"function"!==typeof window.L.tileLayer||"function"!==typeof window.L.layerGroup)return void console.error("Leafletæ ¸å¿ƒåŠŸèƒ½ä¸å¯ç”¨");const a=window.L,s=[34.263161,108.948024],i=13,o=document.getElementById("map");if(!o)return void console.error("åœ°å›¾å®¹å™¨å…ƒç´ ä¸å­˜åœ¨");this.map=a.map(o,{zoomControl:!0,attributionControl:!0,editable:!1}).setView(s,i);const n=a.tileLayer("https://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",{subdomains:["1","2","3","4"],attribution:"é«˜å¾·åœ°å›¾ 2025 Â· ç©ºé—´æ™ºèƒ½",crossOrigin:!0,maxZoom:18,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=="}),r=a.tileLayer("https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",{subdomains:["1","2","3","4"],attribution:"é«˜å¾·åœ°å›¾ 2025 Â· ç©ºé—´æ™ºèƒ½",crossOrigin:!0,maxZoom:18,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=="}),l=a.layerGroup([n,r]),c={"å«æ˜Ÿå½±åƒ":n,"å«æ˜Ÿå½±åƒ+è·¯ç½‘":l};"function"===typeof a.control.layers&&a.control.layers(c).addTo(this.map);try{n.addTo(this.map)}catch(t){console.error("åŠ è½½å«æ˜Ÿå½±åƒå¤±è´¥ï¼Œä½¿ç”¨å¤‡é€‰å›¾å±‚:",t)}if(this.pathService&&"function"===typeof this.pathService.initialize)try{this.pathService.initialize(this.map)}catch(e){console.error("åˆå§‹åŒ–è·¯å¾„è§„åˆ’æœåŠ¡å¤±è´¥:",e)}console.log("åœ°å›¾åˆå§‹åŒ–å®Œæˆ"),this.initializeMapFeatures()}catch(a){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",a)}},initializeMapFeatures(){try{if(!this.map||"object"!==typeof this.map)return void console.error("æ— æ³•åˆå§‹åŒ–åœ°å›¾åŠŸèƒ½ï¼šåœ°å›¾å®ä¾‹ä¸å­˜åœ¨æˆ–æ— æ•ˆ");if(!window.L||"object"!==typeof window.L)return void console.error("æ— æ³•åˆå§‹åŒ–åœ°å›¾åŠŸèƒ½ï¼šLeafletåº“æœªæ­£ç¡®åŠ è½½");const t=window.L;if("function"===typeof t.featureGroup)this.drawnItems=t.featureGroup().addTo(this.map);else{if(console.warn("Leaflet featureGroupåŠŸèƒ½ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨åŸºç¡€å›¾å±‚"),"function"!==typeof t.layerGroup)return void console.error("æ— æ³•åˆ›å»ºå›¾å±‚ç»„ï¼ŒLeafletåŠŸèƒ½ä¸¥é‡å—é™");this.drawnItems=t.layerGroup().addTo(this.map)}console.log("åœ°å›¾åŠŸèƒ½åˆå§‹åŒ–å®Œæˆï¼Œå°†åœ¨éœ€è¦æ—¶ä½¿ç”¨å®‰å…¨çš„APIè°ƒç”¨"),this.addDemoFarmland(),console.log("åœ°å›¾åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ")}catch(t){console.error("åœ°å›¾åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥:",t)}},addDemoFarmland(){try{if(!this.drawnItems||!window.L||"function"!==typeof window.L.polygon)return void console.error("æ— æ³•æ·»åŠ ç¤ºä¾‹å†œç”°ï¼šç¼ºå°‘å¿…è¦ç»„ä»¶");const t=window.L,e=[{id:"a",name:"å†œç”°A",vertices:[[34.26,108.945],[34.26,108.95],[34.265,108.95],[34.265,108.945]],properties:{area:50,perimeter:1500,avgHeight:.7,cropType:"å°éº¦"},style:{color:"#4caf50",fillColor:"#4caf50",fillOpacity:.3,weight:3}},{id:"b",name:"å†œç”°B",vertices:[[34.265,108.95],[34.265,108.955],[34.27,108.955],[34.27,108.95]],properties:{area:65,perimeter:1800,avgHeight:.9,cropType:"ç‰ç±³"},style:{color:"#8bc34a",fillColor:"#8bc34a",fillOpacity:.3,weight:3}},{id:"c",name:"å†œç”°C",vertices:[[34.26,108.95],[34.26,108.955],[34.265,108.955],[34.265,108.95]],properties:{area:40,perimeter:1200,avgHeight:.6,cropType:"æ°´ç¨»"},style:{color:"#00bcd4",fillColor:"#00bcd4",fillOpacity:.3,weight:3}}];this.farmlandLayers={},e.forEach(e=>{const a=t.polygon(e.vertices,e.style).addTo(this.drawnItems);this.farmlandLayers[e.id]=a,a.on("click",()=>{Object.values(this.farmlandLayers).forEach(t=>{t&&"function"===typeof t.setStyle&&t.setStyle({color:t._originalColor||"#4caf50",weight:3})}),a._originalColor=e.style.color,this.selectedVertices=e.vertices,this.selectedArea=e.properties,this.cropType=e.properties.cropType,a.setStyle({color:"#ff9800",weight:4}),this.showResultModal=!0,this.resultModalTitle=`åŒºåŸŸå·²é€‰æ‹©ï¼š${e.name}`,this.resultModalMessage=`å·²é€‰æ‹©${e.name}ï¼Œä½œç‰©ç±»å‹ä¸º${e.properties.cropType}ï¼Œé¢ç§¯çº¦${e.properties.area}äº©ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨æ™ºèƒ½è·¯å¾„è§„åˆ’åŠŸèƒ½ç”Ÿæˆæœ€ä¼˜å–·æ´’è·¯å¾„ã€‚`}),a.bindPopup(`${e.name}ï¼Œç‚¹å‡»é€‰æ‹©`)}),console.log("å·²æ·»åŠ 3ä¸ªç¤ºä¾‹å†œç”°åŒºåŸŸï¼šAã€Bã€C")}catch(t){console.error("æ·»åŠ ç¤ºä¾‹å†œç”°å¤±è´¥:",t)}},enableAreaSelection(){try{if(!this.map||!this.drawnItems)return this.showResultModal=!0,this.resultModalTitle="åœ°å›¾æœªå‡†å¤‡å¥½",void(this.resultModalMessage="åœ°å›¾æœªå®Œå…¨åˆå§‹åŒ–ï¼Œè¯·ç¨åå†è¯•ã€‚");if(!window.L||"object"!==typeof window.L)return this.showResultModal=!0,this.resultModalTitle="åœ°å›¾æœåŠ¡é”™è¯¯",void(this.resultModalMessage="åœ°å›¾æœåŠ¡æœªæ­£ç¡®åŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚");const t=window.L;this.drawnItems.clearLayers();let e=[],a=null;const s=this,i=i=>{try{if(!i?.latlng)return;e.push([i.latlng.lat,i.latlng.lng]),s.drawnItems&&"function"===typeof t.marker&&(t.marker([i.latlng.lat,i.latlng.lng]).addTo(s.drawnItems),a&&s.drawnItems.removeLayer(a),e.length>2&&(a=t.polygon(e,{color:"#2196F3",fillOpacity:.2,dashArray:"5, 5"}).addTo(s.drawnItems)))}catch(o){console.error("å¤„ç†åœ°å›¾ç‚¹å‡»æ—¶å‡ºé”™:",o)}},o=()=>{try{if(e.length>2){e.push(e[0]),s.drawnItems&&"function"===typeof t.polygon&&(t.polygon(e,{color:"#4caf50",fillColor:"#4caf50",fillOpacity:.3,weight:3}).addTo(s.drawnItems),a&&s.drawnItems.removeLayer(a)),s.selectedVertices=e;const i=s.calculateArea?s.calculateArea(e):0,o=s.calculatePerimeter?s.calculatePerimeter(e):0;s.selectedArea={area:i,perimeter:o,avgHeight:.8,cropType:s.cropType||"æœªæŒ‡å®š"},s.showResultModal=!0,s.resultModalTitle="åŒºåŸŸç»˜åˆ¶å®Œæˆ",s.resultModalMessage=`å·²æˆåŠŸç»˜åˆ¶ä½œä¸šåŒºåŸŸï¼Œé¢ç§¯çº¦ä¸º${i.toFixed(2)}äº©ã€‚`}else s.showResultModal=!0,s.resultModalTitle="åŒºåŸŸæ— æ•ˆ",s.resultModalMessage="è¯·è‡³å°‘é€‰æ‹©3ä¸ªç‚¹æ¥å®šä¹‰ä¸€ä¸ªæœ‰æ•ˆåŒºåŸŸã€‚"}catch(n){console.error("å®ŒæˆåŒºåŸŸé€‰æ‹©æ—¶å‡ºé”™:",n),s.showResultModal=!0,s.resultModalTitle="æ“ä½œå¤±è´¥",s.resultModalMessage="å®ŒæˆåŒºåŸŸé€‰æ‹©æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•ã€‚"}finally{s.map&&(s.map.off("click",i),s.map.off("dblclick",o)),s.isSelectingArea=!1}};this.map.off("click",i),this.map.off("dblclick",o),this.map.on("click",i),this.map.on("dblclick",o)}catch(t){console.error("å¯ç”¨åŒºåŸŸé€‰æ‹©åŠŸèƒ½å¤±è´¥:",t),this.showResultModal=!0,this.resultModalTitle="åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥",this.resultModalMessage="æ— æ³•å¯ç”¨åŒºåŸŸé€‰æ‹©åŠŸèƒ½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚",this.isSelectingArea=!1}},calculateArea(t){try{const e=window.L;if(e&&"function"===typeof e.latLngBounds){const a=e.latLngBounds(t),s=a.getCenter(),i=a.getNorthEast(),o=this.calculateDistance(s.lat,s.lng,i.lat,i.lng);return Math.pow(o,2)/666.67}const a=6371e3;let s=0;for(let i=0;i<t.length-1;i++){const e=t[i],a=t[i+1];s+=(a[1]-e[1])*(2+Math.sin(e[0]*Math.PI/180)+Math.sin(a[0]*Math.PI/180))}return s=Math.abs(s*a*a/2),s/666.67}catch(e){return console.error("è®¡ç®—é¢ç§¯æ—¶å‡ºé”™:",e),0}},calculatePerimeter(t){try{let e=0;for(let a=0;a<t.length-1;a++)e+=this.calculateDistance(t[a][0],t[a][1],t[a+1][0],t[a+1][1]);return e}catch(e){return console.error("è®¡ç®—å‘¨é•¿æ—¶å‡ºé”™:",e),0}},calculateDistance(t,e,a,s){try{const i=window.L;if(i&&"function"===typeof i.latLng){const o=i.latLng(t,e),n=i.latLng(a,s);return o.distanceTo(n)}const o=6371e3,n=t*Math.PI/180,r=a*Math.PI/180,l=(a-t)*Math.PI/180,c=(s-e)*Math.PI/180,h=Math.sin(l/2)*Math.sin(l/2)+Math.cos(n)*Math.cos(r)*Math.sin(c/2)*Math.sin(c/2),u=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return o*u}catch(i){return console.error("è®¡ç®—è·ç¦»æ—¶å‡ºé”™:",i),0}},toggleCropHealth(){this.showCropHealth=!this.showCropHealth,this.updateMapLayers()},toggleDronePaths(){this.showDronePaths=!this.showDronePaths,this.updateMapLayers()},togglePestAreas(){this.showPestAreas=!this.showPestAreas,this.updateMapLayers()},toggleAreaSelection(){this.isSelectingArea=!this.isSelectingArea,this.isEditingPath=!1,this.isDrawingPath=!1,this.isSelectingArea&&this.enableAreaSelection()},togglePathEdit(){this.isEditingPath=!this.isEditingPath,this.isSelectingArea=!1,this.isDrawingPath=!1},toggleManualPathPlanning(){this.isDrawingPath=!this.isDrawingPath,this.isSelectingArea=!1,this.isEditingPath=!1},cancelAreaSelection(){this.isSelectingArea=!1,this.map&&(this.map.off("click"),this.map.off("dblclick"))},cancelPathEdit(){this.isEditingPath=!1},async generateOptimalPath(){try{const a=window.L;if(!a||"object"!==typeof a)return this.showResultModal=!0,this.resultModalTitle="åœ°å›¾æœåŠ¡é”™è¯¯",void(this.resultModalMessage="åœ°å›¾æœåŠ¡æœªæ­£ç¡®åŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚");if(!this.selectedVertices||0===this.selectedVertices.length)return this.showResultModal=!0,this.resultModalTitle="æç¤º",void(this.resultModalMessage="è¯·å…ˆé€‰æ‹©ä½œä¸šåŒºåŸŸ");if(!this.pathService||"function"!==typeof this.pathService.generateOptimalRoute)return this.showResultModal=!0,this.resultModalTitle="æœåŠ¡é”™è¯¯",void(this.resultModalMessage="è·¯å¾„è§„åˆ’æœåŠ¡æœªæ­£ç¡®åˆå§‹åŒ–ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚");this.showResultModal=!0,this.resultModalTitle="è·¯å¾„ä¼˜åŒ–ä¸­",this.resultModalMessage="æ­£åœ¨ä½¿ç”¨AIç®—æ³•ç”Ÿæˆæœ€ä¼˜å–·æ´’è·¯å¾„ï¼Œè¯·ç¨å€™...";const s={vertices:this.selectedVertices,obstacles:[],area:this.selectedArea?.area||0},i=await this.pathService.generateOptimalRoute(s,this.selectedVertices,this.cropType,this.environmentData||{temperature:25,humidity:60,windSpeed:3},this.droneData||{maxTurnAngle:30,operationWidth:5});if(i&&i.success&&i.path&&i.path.length>0){if(this.currentPath=i.path,this.resultModalTitle="è·¯å¾„ä¼˜åŒ–å®Œæˆ",this.resultModalMessage=`åŸºäºAIç®—æ³•çš„æœ€ä¼˜å–·æ´’è·¯å¾„å·²ç”Ÿæˆï¼\nè·¯å¾„æ€»é•¿åº¦ï¼š${i.metrics?.totalDistance||0}ç±³\né¢„è®¡é£è¡Œæ—¶é—´ï¼š${Math.round((i.metrics?.estimatedTime||0)/60)}åˆ†é’Ÿ\nä¼˜åŒ–æ•ˆç‡ï¼š${(i.metrics?.estimatedEfficiency||0).toFixed(1)}%\né¢„è®¡å¯èŠ‚çœçº¦20%çš„ä½œä¸šæ—¶é—´å’Œå†œè¯ç”¨é‡ã€‚`,this.map&&"object"===typeof this.map){const a=window.L||X();if(!a||"function"!==typeof a.polyline)return void console.warn("Leafletä¸å¯ç”¨æˆ–polylineåŠŸèƒ½ç¼ºå¤±");if(this.currentPathLayer){try{"function"===typeof this.currentPathLayer.remove?this.currentPathLayer.remove():"function"===typeof this.map.removeLayer&&this.map.removeLayer(this.currentPathLayer)}catch(t){console.warn("ç§»é™¤æ—§è·¯å¾„å›¾å±‚å¤±è´¥:",t)}this.currentPathLayer=null}try{const t=a.polyline(i.path,{color:"#ff0000",weight:4,dashArray:"10, 5"});"function"===typeof t.addTo&&"object"===typeof this.map&&(this.currentPathLayer=t,t.addTo(this.map))}catch(e){console.error("åˆ›å»ºè·¯å¾„å¤±è´¥:",e)}}}else this.resultModalTitle="è·¯å¾„ä¼˜åŒ–å¤±è´¥",this.resultModalMessage="æ— æ³•ç”Ÿæˆè·¯å¾„ï¼Œè¯·æ£€æŸ¥åŒºåŸŸè®¾ç½®å¹¶é‡è¯•ã€‚"}catch(a){console.error("è·¯å¾„è§„åˆ’å¤±è´¥:",a),this.showResultModal=!0,this.resultModalTitle="è·¯å¾„ä¼˜åŒ–å¤±è´¥",this.resultModalMessage=`è·¯å¾„è§„åˆ’è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼š${a.message||"æœªçŸ¥é”™è¯¯"}ï¼Œè¯·é‡è¯•ã€‚`}},executeTask(){if(!this.selectedArea)return this.showResultModal=!0,this.resultModalTitle="æç¤º",void(this.resultModalMessage="è¯·å…ˆé€‰æ‹©ä½œä¸šåŒºåŸŸ");this.showResultModal=!0,this.resultModalTitle="ä»»åŠ¡å·²å¯åŠ¨",this.resultModalMessage="æ— äººæœºä½œä¸šä»»åŠ¡å·²æˆåŠŸå¯åŠ¨ï¼Œé¢„è®¡å®Œæˆæ—¶é—´çº¦30åˆ†é’Ÿã€‚"},fetchEnvironmentData(){setTimeout(()=>{this.environmentData={temperature:26.5,humidity:62,windSpeed:3.5,precipitation:0}},1e3)},analyzeCropHealth(){this.showResultModal=!0,this.resultModalTitle="ä½œç‰©å¥åº·åˆ†æ",this.resultModalMessage="åˆ†æå®Œæˆï¼š85%åŒºåŸŸä½œç‰©ç”Ÿé•¿è‰¯å¥½ï¼Œ15%åŒºåŸŸéœ€è¦é¢å¤–æ–½è‚¥ã€‚å»ºè®®å¢åŠ æ°®è‚¥æ–½åŠ é‡15%ã€‚"},analyzeSoilCondition(){this.showResultModal=!0,this.resultModalTitle="åœŸå£¤æ¡ä»¶åˆ†æ",this.resultModalMessage="åœŸå£¤æ£€æµ‹ï¼šPHå€¼6.8ï¼ˆé€‚å®œï¼‰ï¼Œæœ‰æœºè´¨å«é‡3.2%ï¼ˆä¸­ç­‰ï¼‰ï¼Œå»ºè®®å¢åŠ æœ‰æœºè‚¥ä½¿ç”¨ã€‚"},predictHarvest(){this.showResultModal=!0,this.resultModalTitle="äº§é‡é¢„æµ‹",this.resultModalMessage="æ ¹æ®å½“å‰ç”Ÿé•¿æƒ…å†µå’Œå†å²æ•°æ®ï¼Œé¢„è®¡äº§é‡ä¸ºæ¯äº©650å…¬æ–¤ï¼Œæ¯”å»å¹´åŒæœŸå¢é•¿12%ã€‚"},optimizeIrrigation(){this.showResultModal=!0,this.resultModalTitle="çŒæº‰ä¼˜åŒ–",this.resultModalMessage="çŒæº‰æ–¹æ¡ˆå·²ä¼˜åŒ–ï¼šå»ºè®®æ¯3å¤©çŒæº‰ä¸€æ¬¡ï¼Œæ¯æ¬¡ç”¨æ°´é‡å‡å°‘25%ï¼Œé‡‡ç”¨æ»´çŒæ–¹å¼å¯è¿›ä¸€æ­¥èŠ‚æ°´ã€‚"},updateMapLayers(){console.log("æ›´æ–°åœ°å›¾å›¾å±‚")},closeResultModal(){this.showResultModal=!1},handleMapZoom(){}}},tt=a(1241);const et=(0,tt.A)(Y,[["render",J],["__scopeId","data-v-132faa90"]]);var at=et}}]);
//# sourceMappingURL=285.ff543f7e.js.map